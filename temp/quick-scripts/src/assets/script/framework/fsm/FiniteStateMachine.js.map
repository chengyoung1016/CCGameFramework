{"version":3,"sources":["assets/script/framework/fsm/FiniteStateMachine.ts"],"names":[],"mappings":"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","file":"","sourceRoot":"/","sourcesContent":["import FSMState from \"./FSMState\";\n\nexport default class FiniteStateMachine<T> {\n    private Owner : T;\n    private CurrentState : FSMState<T>;\n    private PreviousState : FSMState<T>;\n    private GlobalState : FSMState<T>;\n\n    private stateRef : {[index:number]:FSMState<T>} = {};\n\n    public onLoad(){\n        this.CurrentState = null;\n        this.PreviousState = null;\n        this.GlobalState = null;\n    }\n\n    constructor(owner : T){\n        this.Owner = owner;\n    }\n\n    public Update(dt){\n        if(this.GlobalState != null){\n            this.GlobalState.Excute(dt);\n        }\n        if(this.CurrentState != null){\n            this.CurrentState.Excute(dt);\n        }\n    }\n\n    public LateUpdate(){\n        if(this.GlobalState != null){\n            this.GlobalState.LateExcute();\n        }\n        if(this.CurrentState != null){\n            this.CurrentState.LateExcute();\n        }\n    }\n\n    public ChangeGlobalState(newGlobal : FSMState<T>, ...params : any){\n        if(this.GlobalState != null){\n            this.GlobalState = newGlobal;\n            this.GlobalState.Enter(...params);\n            return;\n        }\n\n        this.GlobalState.Exit();\n        this.GlobalState = newGlobal;\n        if(this.GlobalState != null){\n            this.GlobalState.Enter(...params);\n        }\n    }\n\n    public ChangeGlobalStateById(stateID : number, ...params){\n        let state = this.stateRef[stateID];\n        this.ChangeGlobalState(state, ...params);\n    }\n\n    public ChangeState(newState : FSMState<T>, ...params : any){\n        this.PreviousState = this.CurrentState;\n        if(this.CurrentState != null){\n            this.CurrentState.Exit();\n        }\n        this.CurrentState = newState;\n\n        if(this.CurrentState != null){\n            this.CurrentState.Enter(...params);\n        }\n    }\n\n    public RevertToPreviousState(){\n        if(this.PreviousState != null){\n            this.ChangeState(this.PreviousState);\n        }\n    }\n\n    public ChangeStateById(stateID : number, ...params:any){\n        let state = this.stateRef[stateID];\n        this.ChangeState(state, ...params);\n    }\n\n    public RegisterState(state : FSMState<T>) : FSMState<T> {\n        state.RegisterState(this.Owner);\n        this.stateRef[state.StateID()] = state;\n        return state;\n    }\n\n    public GetCurStateID() : number {\n        if(this.CurrentState != null){\n            return this.CurrentState.StateID();\n        }\n        return 0;\n    }\n\n    public GetCurState() : FSMState<T> {\n        return this.CurrentState;\n    }\n\n    public UnregisterState(state : FSMState<T>){\n        this.stateRef[state.StateID()] = null;\n    }\n}\n"]}